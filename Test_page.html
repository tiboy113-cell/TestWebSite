<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Local Grey Kiosk</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://unpkg.com/html5-qrcode"></script>
  <style>
    :root {
      --main-blue: #0063b0;
      --header-grey: #5A5D64;
      --input-grey: #f4f6f9;
    }
    html, body {
      min-height: 100vh; margin: 0; box-sizing: border-box;
      background: var(--main-blue);
    }
    body {
      font-family: "SF Pro Display", Arial, sans-serif;
      color: #202022;
    }
    .outer-container {
      min-height: 100vh; min-width: 100vw;
      display: flex; align-items: center; justify-content: center;
      background: var(--main-blue);
    }
    .main-card {
      width: 100%;
      max-width: 900px;
      min-width: 340px;
      background: #fff;
      border-radius: 36px;
      box-shadow: 0 8px 44px #04539330;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      min-height: 480px;
      margin: 32px 0 32px 0;
    }
    .header-bar {
      background: var(--header-grey);
      color: #fff;
      padding: 36px 0 30px 0;
      text-align: center;
      font-size: 2.32rem;
      font-weight: bold;
      letter-spacing: .02em;
      border-radius: 36px 36px 0 0;
    }
    .form-area {
      flex: 1 1 auto;
      padding: 54px 62px 52px 62px;
      background: #fff;
      display: flex;
      flex-direction: column;
      align-items: stretch;
      min-height: 400px;
    }
    @media (max-width:900px) {
      .main-card { max-width: 99vw; }
      .form-area { padding: 36px 10px 24px 10px; }
      .header-bar { font-size: 2.1rem; }
    }
    @media (max-width:550px) {
      .main-card, .header-bar, .form-area { border-radius: 0; }
      .form-area { padding: 17vw 3vw 13vw 3vw; }
    }
    /* Step label (blue, bold) */
    .form-area label {
      color: var(--main-blue);
      font-weight: bold;
      font-size: 1.11em;
      margin: 0 0 10px 0;
    }
    /* Select/inputs as in design */
    .input-wrap {
      margin-bottom: 36px;
      width: 100%;
    }
    .input, .selectbox, .picker-input {
      width: 100%;
      border-radius: 16px;
      font-size: 1.33em;
      background: #f4f6f9;
      padding: 25px 18px 19px 18px;
      border: 1.7px solid #ced6df;
      margin-bottom: 12px;
      box-sizing: border-box;
      font-weight: bold;
    }
    .input:focus, .picker-input:focus, .selectbox:focus {
      border-color: var(--main-blue);
      background: #eef4fe;
    }
    .picker-input {
      cursor: pointer;
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .picker-arrow { font-size: 2em; color: #0b4289; user-select: none;}
    .btn-main {
      margin-top: 63px;
      background: var(--main-blue);
      color: #fff;
      border: none;
      width: 100%;
      padding: 29px 14px 26px 14px;
      font-size: 2.1rem;
      font-weight: bold;
      border-radius: 25px;
      box-shadow: 0 2px 22px #00336623;
      cursor: pointer;
      transition: background .14s, box-shadow .14s;
      letter-spacing: 0.03em;
      position: relative;
      z-index: 1;
      margin-bottom: 14px;
    }
    .btn-main:active { background: #004981;}
    .btn-secondary {
      margin-top: 5px;
      background: #fff;
      color: var(--main-blue);
      border: 2px solid var(--main-blue);
      font-size: 1.15em;
      border-radius: 18px;
      font-weight: 700;
      padding: 22px 14px 20px 14px;
      box-shadow: none;
      margin-bottom: 13px;
      cursor: pointer;
      width: 100%;
    }
    .card {
      background: #e6f0fa;
      border-radius: 18px;
      padding: 19px 21px 15px 21px;
      font-size: 1.15rem;
      margin: 0 0 34px 0;
      box-shadow: 0 2px 13px #188bce17;
    }
    /* receipts */
    .receipt-list {
      background: #f4f6f9;
      border-radius: 18px;
      padding: 15px 12px 12px 12px;
      margin-bottom: 17px;
    }
    .receipt {
      background: #fff;
      border-radius: 13px;
      box-shadow: 0 1px 5px #0054A622;
      padding: 13px 17px;
      margin-bottom: 12px;
      display:flex;justify-content:space-between;align-items:center;font-size:1.08rem;
    }
    /* More receipts button */
    .show-more-receipts { 
      color: var(--main-blue); background:transparent;
      border:none; font-weight:600; font-size:1.13rem;
      text-align:left; margin:10px 0 0 0; cursor:pointer; width:100%; padding:8px 0 17px 7px;
    }
    /* Modal overlays always on top & centered */
    .modal-bg,.overlay {
      background: rgba(0,50,140,.11);
      position:fixed;top:0;left:0;right:0;bottom:0;z-index: 10010;
    }
    .popup, .picker-modal, .qr-modal, .date-modal {
      position: fixed; left:50%; top:50%; transform:translate(-50%,-50%);
      z-index: 10090;
      background: #fff; border-radius: 18px; box-shadow: 0 8px 50px #39466a1c;
      min-width:320px; max-width:96vw; min-height:110px;
      padding:36px 31px 37px 30px;
      font-size: 1.15em;
    }
    .popup h3 { margin-top:0; }
    #reader > video, .qr-modal video { border-radius: 14px !important; }
    .qr-close { background:var(--main-blue); color:#fff; border:none; border-radius:9px; font-size:1.17em; font-weight:700; padding:13px 45px; margin-top:22px; cursor:pointer; margin-bottom:2px;}
    .qr-close:hover { background: #004981;}
  </style>
</head>
<body>
  <div class="outer-container">
    <div class="main-card">
      <div class="header-bar">Local Grey</div>
      <div class="form-area" id="ui-content"></div>
    </div>
  </div>
  <div id="modalBg" class="modal-bg" style="display:none"></div>
  <script>
const state = {
  step: 0,
  language: "English",
  passport: "",
  qrData: "",
  traveler: { name: "", address: "", email: "", passport: "" },
  residence: { country: "", departure: "" },
  memberEmail: "",
  receipts: [
    {number: '12345', amount: 150, store: 'PRINTEMPS'},
    {number: '23456', amount: 87, store: 'Lafayette'},
    {number: '42407', amount: 224, store: 'ZARA'}
  ],
  refund: "",
  agreed: false,
  needAssistant: false,
  assistantApproved: false,
  receiptsShowAll: true // always show all, only 3 prefill
};
const languages = ["English","Mandarin","Hindi","Spanish","French","Arabic","Bengali","Russian","Portuguese","Urdu","Indonesian","German","Japanese","Swahili","Marathi","Telugu","Turkish","Korean","Vietnamese","Italian"];

function showPickerModal(curr, cb) {
  const modalBg = document.getElementById('modalBg'); modalBg.style.display="block";
  let idx = languages.indexOf(curr); if(idx<0)idx=0;
  const modal = document.createElement('div');
  modal.className='picker-modal';
  modal.innerHTML = `<h3 style="margin-bottom:18px;">Select your language</h3>
    <div style="height:200px;overflow-y:scroll;">
    ${languages.map((lang,i)=>`<div style="padding:15px;font-size:1.17em;border-radius:9px;margin:2px 0;cursor:pointer;background:${i==idx?'#eef6ff':'#fff'};color:${i==idx?'#065ca1':'#233'};" data-i="${i}">${lang}</div>`).join('')}
    </div>
    <button class="btn-main" style="margin-top:20px;margin-bottom:3px;font-size:1.1em;" id="pickLangBtn">OK</button>`;
  document.body.appendChild(modal);
  let picked = idx;
  Array.from(modal.querySelectorAll('[data-i]')).forEach(el=>{
    el.onclick=e=>{
      picked=+el.dataset.i;
      Array.from(modal.querySelectorAll('[data-i]')).forEach(o=>o.style.background='#fff');
      el.style.background='#eef6ff';
    }
  });
  modal.querySelector('#pickLangBtn').onclick = ()=>{cb(languages[picked]); cls();}
  function cls(){document.body.removeChild(modal);modalBg.style.display="none";}
  modalBg.onclick=cls;
}
function showQrModal(onScan) {
  if(window.qrScannerActive)return;window.qrScannerActive=true;
  const modalBg=document.getElementById("modalBg");modalBg.style.display="block";
  let qrdiv = document.createElement("div");
  qrdiv.className = "qr-modal";
  qrdiv.innerHTML = `<div id="reader" style="width:99vw;max-width:320px"></div><button class="qr-close" id="qrCloseBtn">Close</button>`;
  document.body.appendChild(qrdiv);
  let qr=new Html5Qrcode("reader");
  qr.start({facingMode:"environment"},{fps:10,qrbox:220},code=>{
    onScan(code);
    qr.stop();
    document.body.removeChild(qrdiv);
    modalBg.style.display="none";
  },()=>{});
  document.getElementById('qrCloseBtn').onclick=()=>{qr.stop();document.body.removeChild(qrdiv);modalBg.style.display="none";}
  modalBg.onclick=()=>{qr.stop();document.body.removeChild(qrdiv);modalBg.style.display="none";}
}
function getSummaryText() {
  return [
    `Language: ${state.language}`,
    `Name: ${state.traveler.name}`,
    `Address: ${state.traveler.address}`,
    `Email: ${state.traveler.email}`,
    `Passport/ID: ${state.passport}`,
    state.qrData ? `QR Scanned: ${state.qrData}` : "",
    `Residence: ${state.residence.country}`,
    `Departure: ${state.residence.departure}`,
    `Refund: ${state.refund}`,
    `Receipts: ${state.receipts.length}`
  ].filter(Boolean).join('\n');
}
const steps = [
  // Select language
  ()=>{
    return `
      <label>Select your language</label>
      <div class="input-wrap"><div class="picker-input" id="langPickerBtn">
        <span>${state.language}</span>
        <span class="picker-arrow">&#9662;</span>
      </div></div>
      <button class="btn-main" id="langNextBtn">Next</button>
    `;
  },
  // Document ready
  ()=>`
    <h2>Have your documents ready</h2>
    <div class="card">
      <ul>
        <li>Passport or ID</li><li>Sales Receipts</li><li>Credit Card or eWallet</li>
      </ul>
      <span class="elig">Eligibility:</span>
      <ul>
        <li>16 years old or older</li>
        <li>Not a European Union resident</li>
        <li>Get Customs validation within 3 months of issuance</li>
      </ul>
    </div>
    <button class="btn-main" id="docNextBtn">Next</button>
  `,
  // Passport/ID
  ()=>`
    <h2>Passport/ID Scanning</h2>
    <video id="passportVideo" controls autoplay playsinline muted poster="https://dummyimage.com/890x250/cccccc/222222&text=Passport+Scan">
      <source src="https://www.w3schools.com/html/mov_bbb.mp4" type="video/mp4"/>
    </video>
    <div class="input-label" style="margin-top:18px;">Type your Passport or ID number</div>
    <input class="input" id="passportInput" autocomplete="off" placeholder="Passport or ID Number" value="${state.passport||''}">
    <button class="btn-secondary" id="qrbtn">Scan QR code</button>
    <button class="btn-main" id="passportNextBtn">Continue</button>
  `,
  // Traveler info
  ()=>`
    <h2>Traveler Information</h2>
    <input class="input" id="travelerName" placeholder="Full Name" value="${state.traveler.name||''}"/>
    <input class="input" id="travelerAddress" placeholder="Address" value="${state.traveler.address||''}"/>
    <input class="input" id="travelerEmail" type="email" placeholder="Email" value="${state.traveler.email||''}"/>
    <input class="input" id="travelerPassport" placeholder="Passport/ID Number" value="${state.traveler.passport||state.passport||''}"/>
    <button class="btn-main" id="travelerNextBtn">Next</button>
  `,
  // Residence and departure
  ()=>`
    <h2>Residence & Departure</h2>
    <input class="input" id="residenceCountry" placeholder="Country of Residence" value="${state.residence.country||''}"/>
    <div class="input-wrap" style="margin-top:8px;">
      <div class="picker-input" id="datePickerBtn">
        <span>${state.residence.departure ? state.residence.departure : "Select departure date"}</span>
        <span class="picker-arrow">&#128197;</span>
      </div>
    </div>
    <button class="btn-main" id="residenceNextBtn">Next</button>
  `,
  // Member
  ()=>`
    <h2>Become a Member (optional)</h2>
    <input class="input" id="memberEmail" placeholder="Email" value="${state.memberEmail||''}" />
    <button class="btn-main" id="membershipJoinBtn">Join</button>
    <button class="btn-secondary" id="membershipSkipBtn">Skip</button>
  `,
  // Receipts
  ()=> {
    let receiptsHtml = state.receipts.map((r,i)=>`<div class="receipt"><span>Receipt #${r.number}, â‚¬${r.amount}, Store: ${r.store}</span>
    <button class="btn-secondary" style="width:auto;padding:4px 12px" onclick="window.showReceipt(${i})">View</button></div>`).join('');
    return `
      <h2>Your Receipts</h2>
      <div class="receipt-list" id="receiptsList">
        ${receiptsHtml}
      </div>
      <button class="btn-secondary" id="scanReceiptBtn">Scan New Receipt</button>
      <button class="btn-main" id="receiptsNextBtn">Next</button>
    `;
  },
  // Refund
  ()=>`
    <h2>Choose Refund Method</h2>
    <button class="btn-main" id="refundCCBtn">Credit Card</button>
    <button class="btn-main" id="refundWalletBtn">Digital Wallet</button>
    <button class="btn-main" id="refundCashBtn">Cash</button>
  `,
  // Refund instructions
  ()=>`
    <h2>Refund Instructions</h2>
    <video id="refundVideo" controls autoplay muted playsinline poster="https://dummyimage.com/890x250/cccccc/222222&text=Refund+Instructions">
      <source src="https://www.w3schools.com/html/movie.mp4" type="video/mp4"/>
    </video>
    <p>Refund by: <b>${state.refund||''}</b>. Please follow on-screen instructions to register your ${state.refund.toLowerCase()} for refund.</p>
    <button class="btn-main" id="refundNextBtn">Continue</button>
  `,
  // Summary
  ()=>`
    <h2>Summary & Traveler Declaration</h2>
    <textarea readonly style="font-size:1.08em">${getSummaryText()}</textarea>
    <label class="checkbox-label">
      <input id="agreeCheck" type="checkbox" ${state.agreed?"checked":""}/>
      I accept <button class="linkbtn" id="showTermsLink">Terms & Conditions</button>
      and <button class="linkbtn" id="showDeclarationLink">Traveler Declaration</button>
    </label>
    <button class="btn-main" id="submitBtn">Submit</button>
  `,
  // Shop assistance
  ()=>`
    <h2>Assistance Required</h2>
    <input class="input" id="assistantInput" placeholder="Scan assistant QR code">
    <div style="display:flex;gap:15px;margin-top:22px;">
      <button class="btn-main" id="approveBtn" style="flex:1">Approve</button>
      <button class="btn-secondary" id="rejectBtn" style="flex:1">Reject</button>
    </div>
  `,
  // Collect tax free
  ()=>`
    <h2>Collect your Tax Free Form</h2>
    <video id="taxVideo" controls autoplay muted playsinline poster="https://dummyimage.com/890x250/cccccc/222222&text=Tax+Free+Form">
      <source src="https://www.w3schools.com/html/mov_bbb.mp4" type="video/mp4"/>
    </video>
    <div class="card">Remember to complete Customs validation at departure!</div>
    <button class="btn-main" id="finishBtn">Finish</button>
  `,
  ()=>
    `<div style="text-align:center;margin-top:54px;">
      <h2>Enjoy your journey!</h2>
      <div style="font-size:21px;color:#0054A699;margin:25px;">Thank you!</div>
    </div>`
];

let step = 0;
function renderStep() {
  document.getElementById('ui-content').innerHTML = steps[step]();
  switch(step){
    case 0: // Language
      document.getElementById('langPickerBtn').onclick=function(){
        showPickerModal(state.language,lang=>{state.language=lang;renderStep();});
      }
      document.getElementById('langNextBtn').onclick=()=>{step++;renderStep();};
      break;
    case 1:
      document.getElementById('docNextBtn').onclick=()=>{step++;renderStep();};
      break;
    case 2:
      document.getElementById('passportNextBtn').onclick=()=>{
        state.passport=document.getElementById('passportInput').value.trim();
        state.traveler.passport=state.passport;step++;renderStep();
      };
      document.getElementById('qrbtn').onclick=function(){
        showQrModal(code=>{
          state.passport = code;
          state.qrData = code;
          renderStep();
          setTimeout(()=>{document.getElementById('passportInput').value=state.passport;},80);
        })
      };
      setTimeout(()=>{try{document.getElementById('passportVideo').play();}catch(e){}},300);
      break;
    case 3:
      document.getElementById('travelerNextBtn').onclick=()=>{
        state.traveler.name=document.getElementById('travelerName').value;
        state.traveler.address=document.getElementById('travelerAddress').value;
        state.traveler.email=document.getElementById('travelerEmail').value;
        state.traveler.passport=document.getElementById('travelerPassport').value;
        step++;renderStep();
      };break;
    case 4:
      document.getElementById('datePickerBtn').onclick=function(){
        showDatePicker(state.residence.departure,date=>{state.residence.departure=date;renderStep();});
      };
      document.getElementById('residenceNextBtn').onclick=()=>{
        state.residence.country=document.getElementById('residenceCountry').value;
        step++;renderStep();
      };break;
    case 5:
      document.getElementById('membershipJoinBtn').onclick=()=>{state.memberEmail=document.getElementById('memberEmail').value;step++;renderStep();};
      document.getElementById('membershipSkipBtn').onclick=()=>{state.memberEmail="";step++;renderStep();};
      break;
    case 6:
      document.getElementById('scanReceiptBtn').onclick=()=>{
        state.receipts.push({number:''+(10000+Math.floor(Math.random()*90000)),amount:Math.floor(Math.random()*100+65),store:'NEWSTORE'});renderStep();
      };
      document.getElementById('receiptsNextBtn').onclick=()=>{step++;renderStep();};
      break;
    case 7:
      document.getElementById('refundCCBtn').onclick=()=>{state.refund='Credit Card';step++;renderStep();};
      document.getElementById('refundWalletBtn').onclick=()=>{state.refund='Digital Wallet';step++;renderStep();};
      document.getElementById('refundCashBtn').onclick=()=>{state.refund='Cash';step++;renderStep();};
      break;
    case 8:
      setTimeout(()=>{try{document.getElementById('refundVideo').play();}catch(e){}},220);
      document.getElementById('refundNextBtn').onclick=()=>{step++;renderStep();};
      break;
    case 9:
      document.getElementById('agreeCheck').onchange=e=>{state.agreed = e.target.checked;}
      document.getElementById('showTermsLink').onclick=e=>{e.preventDefault();showPopup("Terms & Conditions","Standard T&C.<br/>For demo purposes.");};
      document.getElementById('showDeclarationLink').onclick=e=>{e.preventDefault();showPopup("Traveler Declaration","I confirm I'm not an EU resident, am above 16, and purchases will leave the EU.");};
      document.getElementById('submitBtn').onclick=()=>{if(!state.agreed)return alert("Please accept the Terms & Conditions and Traveler Declaration.");step++;renderStep();};break;
    case 10:
      document.getElementById('approveBtn').onclick=()=>{state.assistantApproved=true;step++;renderStep();};
      document.getElementById('rejectBtn').onclick=()=>{state.assistantApproved=false;step=0;renderStep();};break;
    case 11:
      setTimeout(()=>{try{document.getElementById('taxVideo').play();}catch(e){}},240);
      document.getElementById('finishBtn').onclick=()=>{step++;renderStep();};break;
  }
}
renderStep();
  </script>
</body>
</html>
